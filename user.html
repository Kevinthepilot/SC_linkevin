<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Ng∆∞·ªùi ch∆°i</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<style>
    body {
        font-family: 'Roboto', sans-serif;
        background: linear-gradient(135deg, #1e1e2f, #2a2a4a);
        color: #fff;
        text-align: center;
        padding: 20px;
    }
    h1 {
        margin-bottom: 20px;
        color: #ffcc00;
    }
    #wantedInfo {
        background: rgba(255,255,255,0.05);
        border-radius: 12px;
        padding: 20px;
        display: inline-block;
        box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    }
    #wantedImg {
        border-radius: 10px;
        max-width: 200px;
        display: block;
        margin: 0 auto 10px;
    }
    .upload-box {
        margin-top: 20px;
        padding: 20px;
        border: 2px dashed #ffcc00;
        border-radius: 12px;
        cursor: pointer;
        transition: 0.3s;
        max-width: 300px;
        margin-left: auto;
        margin-right: auto;
    }
    .upload-box:hover {
        background: rgba(255,255,255,0.05);
        transform: scale(1.02);
    }
    #photoInput {
        display: none;
    }
    .preview-img {
        max-width: 100%;
        border-radius: 8px;
        margin-top: 10px;
        display: none;
    }
    button {
        background: #ffcc00;
        color: #000;
        font-weight: bold;
        padding: 10px 20px;
        border: none;
        border-radius: 8px;
        margin-top: 15px;
        cursor: pointer;
        transition: 0.3s;
    }
    button:hover {
        background: #e6b800;
    }
    #result {
        margin-top: 20px;
        font-size: 1.2em;
        text-align: center;
    }

    #wantedList {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 20px;
        margin-bottom: 20px;
    }
    .wanted-card {
        background: rgba(255,255,255,0.05);
        border-radius: 12px;
        padding: 15px;
        width: 220px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        text-align: center;
    }
    .wanted-card img {
        border-radius: 10px;
        max-width: 100%;
        margin-bottom: 10px;
    }

</style>
</head>
<body>
    <h1>ƒê·ªëi t∆∞·ª£ng b·ªã truy n√£</h1>
    <!-- <div id="wantedInfo">
        <img id="wantedImg" src="" alt="Wanted Person">
        <h2 id="wantedName"></h2>
    </div> -->
    <div id="wantedList"></div>

    <div class="upload-box" onclick="document.getElementById('photoInput').click()">
        üì∑ Nh·∫•n ƒë·ªÉ ch·ªçn ·∫£nh
        <input type="file" id="photoInput" accept="image/*" onchange="previewImage(event)">
        <img id="preview" class="preview-img">
    </div>

    <button onclick="sendPhoto()">G·ª≠i ·∫£nh</button>
    <h2 id="result"></h2>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();

        socket.on('updateWanted', (wantedList) => {
            const container = document.getElementById('wantedList');
            container.innerHTML = ""; // clear old list
            console.log(wantedList)

            wantedList.forEach(wanted => {
                let card = document.createElement("div");
                card.classList.add("wanted-card");

                let img = document.createElement("img");
                img.src = wanted.img;
                img.alt = "Wanted Person";
                img.classList.add("wantedImg");

                let name = document.createElement("h2");
                name.innerText = wanted.name;

                card.appendChild(img);
                card.appendChild(name);

                container.appendChild(card);
            });
        });


        function previewImage(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                const preview = document.getElementById('preview');
                preview.src = e.target.result;
                preview.style.display = 'block';
            }
            reader.readAsDataURL(file);
        }

        function sendPhoto() {
            const file = document.getElementById('photoInput').files[0];
            if (!file) return alert("Ch·ªçn ·∫£nh!");
            const formData = new FormData();
            formData.append("photo", file);
            fetch(`/upload?socketId=${socket.id}`, {
                method: "POST",
                body: formData
            }).then(res => res.json())
            .then(data => {
                if (data.success) alert("‚úÖ ƒê√£ g·ª≠i ·∫£nh th√†nh c√¥ng!");
                else alert("‚ùå G·ª≠i th·∫•t b·∫°i!");
            });
            document.getElementById("photoInput").value = null;
            document.getElementById("preview").src = null;
        }

        socket.on('decision', (data) => {
            repText = "‚úî ·∫¢nh ƒë√∫ng! G·ª£i √Ω: " + data.hint;
            if (!data.accepted){
                repText = "‚ùå ·∫¢nh sai!";
            }
            let rdiv = document.createElement("div");
            rdiv.innerText = repText
            document.getElementById("result").append(rdiv)
        });
    </script>
</body>
</html>
